{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 56, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/tucke/Repositories/EFT-Tracker/apps/web/src/lib/env.ts"],"sourcesContent":["import { z } from \"zod\";\n\n/**\n * Environment variable validation schema\n *\n * This validates all required environment variables at application startup.\n * If any variables are missing or invalid, the application will fail to start\n * with a clear error message.\n */\nconst envSchema = z.object({\n  // Node environment\n  NODE_ENV: z\n    .enum([\"development\", \"production\", \"test\"])\n    .default(\"development\"),\n\n  // Database\n  DATABASE_URL: z\n    .string()\n    .url(\"DATABASE_URL must be a valid PostgreSQL connection string\"),\n\n  // Authentication\n  AUTH_SECRET: z\n    .string()\n    .min(\n      32,\n      \"AUTH_SECRET must be at least 32 characters. Generate with: openssl rand -base64 32\"\n    ),\n  NEXTAUTH_URL: z\n    .string()\n    .url(\"NEXTAUTH_URL must be a valid URL (e.g., https://learntotarkov.com)\"),\n\n  // Optional: GitHub integration\n  GITHUB_PERSONAL_ACCESS_TOKEN: z.string().optional(),\n\n  // Optional: Search features\n  BRAVE_API_KEY: z.string().optional(),\n\n  // Optional: Rate Limiting (Upstash Redis)\n  UPSTASH_REDIS_REST_URL: z\n    .string()\n    .url(\"UPSTASH_REDIS_REST_URL must be a valid URL\")\n    .optional(),\n  UPSTASH_REDIS_REST_TOKEN: z.string().optional(),\n\n  // Optional: Logging\n  LOG_LEVEL: z\n    .enum([\"error\", \"warn\", \"info\", \"debug\"])\n    .default(\"info\")\n    .optional(),\n\n  // Optional: Error Monitoring (Sentry)\n  SENTRY_DSN: z.string().url(\"SENTRY_DSN must be a valid URL\").optional(),\n  NEXT_PUBLIC_SENTRY_DSN: z\n    .string()\n    .url(\"NEXT_PUBLIC_SENTRY_DSN must be a valid URL\")\n    .optional(),\n  SENTRY_ORG: z.string().optional(),\n  SENTRY_PROJECT: z.string().optional(),\n  SENTRY_AUTH_TOKEN: z.string().optional(),\n});\n\n/**\n * Validated environment variables\n *\n * Import this instead of using process.env directly to ensure type safety\n * and runtime validation.\n *\n * @example\n * ```ts\n * import { env } from '@/lib/env';\n *\n * const dbUrl = env.DATABASE_URL; // Type-safe and validated\n * ```\n */\nexport const env =\n  process.env.NODE_ENV === \"test\" || process.env.SKIP_ENV_VALIDATION === \"1\"\n    ? (process.env as z.infer<typeof envSchema>)\n    : envSchema.parse(process.env);\n\nexport type Env = z.infer<typeof envSchema>;\n"],"names":[],"mappings":";;;;AAAA;;AAEA;;;;;;CAMC,GACD,MAAM,YAAY,oOAAC,CAAC,MAAM,CAAC;IACzB,mBAAmB;IACnB,UAAU,oOAAC,CACR,IAAI,CAAC;QAAC;QAAe;QAAc;KAAO,EAC1C,OAAO,CAAC;IAEX,WAAW;IACX,cAAc,oOAAC,CACZ,MAAM,GACN,GAAG,CAAC;IAEP,iBAAiB;IACjB,aAAa,oOAAC,CACX,MAAM,GACN,GAAG,CACF,IACA;IAEJ,cAAc,oOAAC,CACZ,MAAM,GACN,GAAG,CAAC;IAEP,+BAA+B;IAC/B,8BAA8B,oOAAC,CAAC,MAAM,GAAG,QAAQ;IAEjD,4BAA4B;IAC5B,eAAe,oOAAC,CAAC,MAAM,GAAG,QAAQ;IAElC,0CAA0C;IAC1C,wBAAwB,oOAAC,CACtB,MAAM,GACN,GAAG,CAAC,8CACJ,QAAQ;IACX,0BAA0B,oOAAC,CAAC,MAAM,GAAG,QAAQ;IAE7C,oBAAoB;IACpB,WAAW,oOAAC,CACT,IAAI,CAAC;QAAC;QAAS;QAAQ;QAAQ;KAAQ,EACvC,OAAO,CAAC,QACR,QAAQ;IAEX,sCAAsC;IACtC,YAAY,oOAAC,CAAC,MAAM,GAAG,GAAG,CAAC,kCAAkC,QAAQ;IACrE,wBAAwB,oOAAC,CACtB,MAAM,GACN,GAAG,CAAC,8CACJ,QAAQ;IACX,YAAY,oOAAC,CAAC,MAAM,GAAG,QAAQ;IAC/B,gBAAgB,oOAAC,CAAC,MAAM,GAAG,QAAQ;IACnC,mBAAmB,oOAAC,CAAC,MAAM,GAAG,QAAQ;AACxC;AAeO,MAAM,MACX,oDAAyB,UAAU,QAAQ,GAAG,CAAC,mBAAmB,KAAK,MAClE,QAAQ,GAAG,GACZ,UAAU,KAAK,CAAC,QAAQ,GAAG"}},
    {"offset": {"line": 108, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/tucke/Repositories/EFT-Tracker/apps/web/src/lib/prisma.ts"],"sourcesContent":["import { Pool } from \"pg\";\nimport { PrismaPg } from \"@prisma/adapter-pg\";\nimport { PrismaClient } from \"@prisma/client\";\n\nconst globalForPrisma = globalThis as unknown as {\n  prisma: PrismaClient | undefined;\n};\n\nfunction createPrismaClient() {\n  // Lazy import env to avoid validation errors during build time\n  // env.ts validates required env vars, which aren't available during 'next build'\n  // Using dynamic require prevents the module from being evaluated at import time\n  // eslint-disable-next-line @typescript-eslint/no-require-imports\n  const { env } = require(\"./env\") as typeof import(\"./env\");\n\n  const pool = new Pool({\n    connectionString: env.DATABASE_URL,\n    // Connection pool configuration optimized for Neon Free Tier\n    // Neon Free Tier limit: 20 total connections\n    max: 10, // Maximum connections in pool (50% of Neon limit)\n    idleTimeoutMillis: 30000, // Close idle connections after 30 seconds\n    connectionTimeoutMillis: 10000, // Fail fast if connection takes >10 seconds\n  });\n  const adapter = new PrismaPg(pool);\n  return new PrismaClient({ adapter });\n}\n\n// Lazy initialization: store in global object but don't initialize until first use\nif (!globalForPrisma.prisma) {\n  globalForPrisma.prisma = undefined;\n}\n\nexport function getPrismaClient() {\n  if (!globalForPrisma.prisma) {\n    globalForPrisma.prisma = createPrismaClient();\n  }\n  return globalForPrisma.prisma;\n}\n\n// For backwards compatibility, export as a getter\nexport const prisma = new Proxy({} as PrismaClient, {\n  get(target, prop) {\n    const client = getPrismaClient();\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    return (client as any)[prop];\n  },\n});\n"],"names":[],"mappings":";;;;;;AAAA;AACA;AACA;;;;;;;;;AAEA,MAAM,kBAAkB;AAIxB,SAAS;IACP,+DAA+D;IAC/D,iFAAiF;IACjF,gFAAgF;IAChF,iEAAiE;IACjE,MAAM,EAAE,GAAG,EAAE;IAEb,MAAM,OAAO,IAAI,4GAAI,CAAC;QACpB,kBAAkB,IAAI,YAAY;QAClC,6DAA6D;QAC7D,6CAA6C;QAC7C,KAAK;QACL,mBAAmB;QACnB,yBAAyB;IAC3B;IACA,MAAM,UAAU,IAAI,+OAAQ,CAAC;IAC7B,OAAO,IAAI,6IAAY,CAAC;QAAE;IAAQ;AACpC;AAEA,mFAAmF;AACnF,IAAI,CAAC,gBAAgB,MAAM,EAAE;IAC3B,gBAAgB,MAAM,GAAG;AAC3B;AAEO,SAAS;IACd,IAAI,CAAC,gBAAgB,MAAM,EAAE;QAC3B,gBAAgB,MAAM,GAAG;IAC3B;IACA,OAAO,gBAAgB,MAAM;AAC/B;AAGO,MAAM,SAAS,IAAI,MAAM,CAAC,GAAmB;IAClD,KAAI,MAAM,EAAE,IAAI;QACd,MAAM,SAAS;QACf,8DAA8D;QAC9D,OAAO,AAAC,MAAc,CAAC,KAAK;IAC9B;AACF"}},
    {"offset": {"line": 173, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/tucke/Repositories/EFT-Tracker/apps/web/src/lib/logger.ts"],"sourcesContent":["import pino from \"pino\";\nimport { env } from \"./env\";\n\n/**\n * Structured logger using Pino\n *\n * This replaces console.log/error/warn throughout the application with\n * structured JSON logging for better production observability.\n *\n * Features:\n * - Automatic PII redaction (passwords, tokens, emails)\n * - Pretty-printed output in development\n * - JSON output in production for log aggregation\n * - Configurable log levels via LOG_LEVEL env var\n *\n * @example\n * ```ts\n * import { logger } from '@/lib/logger';\n *\n * logger.info({ userId }, 'User registered successfully');\n * logger.error({ err: error }, 'Database query failed');\n * logger.warn({ duration: 1500 }, 'Slow query detected');\n * ```\n */\n\n// Get log level from environment, default to 'info'\nconst logLevel =\n  process.env.LOG_LEVEL || (env.NODE_ENV === \"production\" ? \"info\" : \"debug\");\n\nexport const logger = pino({\n  level: logLevel,\n\n  // Redact sensitive fields from logs\n  redact: {\n    paths: [\n      \"password\",\n      \"token\",\n      \"email\",\n      \"companionToken\",\n      \"apiToken\",\n      \"AUTH_SECRET\",\n      \"DATABASE_URL\",\n      \"*.password\",\n      \"*.token\",\n      \"*.companionToken\",\n      \"req.headers.authorization\",\n      \"req.headers.cookie\",\n    ],\n    censor: \"[REDACTED]\",\n  },\n\n  // Format log level as a string (not a number)\n  formatters: {\n    level: (label) => ({ level: label }),\n  },\n\n  // Use pino-pretty for readable logs in development\n  ...(env.NODE_ENV === \"development\" && {\n    transport: {\n      target: \"pino-pretty\",\n      options: {\n        colorize: true,\n        translateTime: \"HH:MM:ss\",\n        ignore: \"pid,hostname\",\n      },\n    },\n  }),\n});\n\n/**\n * Create a child logger with additional context\n *\n * @example\n * ```ts\n * const reqLogger = logger.child({ requestId: req.id });\n * reqLogger.info('Processing request');\n * ```\n */\nexport function createRequestLogger(requestId: string, userId?: string) {\n  return logger.child({\n    requestId,\n    ...(userId && { userId }),\n  });\n}\n"],"names":[],"mappings":";;;;;;AAAA;AACA;;;AAEA;;;;;;;;;;;;;;;;;;;;CAoBC,GAED,oDAAoD;AACpD,MAAM,WACJ,QAAQ,GAAG,CAAC,SAAS,IAAI,CAAC,yIAAG,CAAC,QAAQ,KAAK,eAAe,SAAS,OAAO;AAErE,MAAM,SAAS,IAAA,4GAAI,EAAC;IACzB,OAAO;IAEP,oCAAoC;IACpC,QAAQ;QACN,OAAO;YACL;YACA;YACA;YACA;YACA;YACA;YACA;YACA;YACA;YACA;YACA;YACA;SACD;QACD,QAAQ;IACV;IAEA,8CAA8C;IAC9C,YAAY;QACV,OAAO,CAAC,QAAU,CAAC;gBAAE,OAAO;YAAM,CAAC;IACrC;IAEA,mDAAmD;IACnD,GAAI,yIAAG,CAAC,QAAQ,KAAK,iBAAiB;QACpC,WAAW;YACT,QAAQ;YACR,SAAS;gBACP,UAAU;gBACV,eAAe;gBACf,QAAQ;YACV;QACF;IACF,CAAC;AACH;AAWO,SAAS,oBAAoB,SAAiB,EAAE,MAAe;IACpE,OAAO,OAAO,KAAK,CAAC;QAClB;QACA,GAAI,UAAU;YAAE;QAAO,CAAC;IAC1B;AACF"}},
    {"offset": {"line": 257, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/tucke/Repositories/EFT-Tracker/apps/web/src/app/api/traders/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\nimport { prisma } from \"@/lib/prisma\";\nimport { Prisma } from \"@prisma/client\";\nimport { logger } from \"@/lib/logger\";\nimport { withRateLimit } from \"@/lib/middleware/rate-limit-middleware\";\nimport { RATE_LIMITS } from \"@/lib/rate-limit\";\n\ntype TraderWithCount = Prisma.TraderGetPayload<{\n  include: {\n    _count: {\n      select: { quests: true };\n    };\n  };\n}>;\n\nasync function handleGET() {\n  try {\n    const traders = await prisma.trader.findMany({\n      orderBy: { name: \"asc\" },\n      include: {\n        _count: {\n          select: { quests: true },\n        },\n      },\n    });\n\n    // Add quest count to response\n    const tradersWithCount = traders.map((trader: TraderWithCount) => ({\n      id: trader.id,\n      name: trader.name,\n      color: trader.color,\n      questCount: trader._count.quests,\n    }));\n\n    return NextResponse.json({\n      traders: tradersWithCount,\n    });\n  } catch (error) {\n    logger.error({ err: error }, \"Error fetching traders\");\n    return NextResponse.json(\n      { error: \"Failed to fetch traders\" },\n      { status: 500 }\n    );\n  }\n}\n\n// Note: Rate limiting removed for read-only public data endpoint\n// Public trader information should be freely accessible without limits\nexport const GET = handleGET;\n"],"names":[],"mappings":";;;;AAAA;AACA;AAEA;;;;;;;;AAYA,eAAe;IACb,IAAI;QACF,MAAM,UAAU,MAAM,+IAAM,CAAC,MAAM,CAAC,QAAQ,CAAC;YAC3C,SAAS;gBAAE,MAAM;YAAM;YACvB,SAAS;gBACP,QAAQ;oBACN,QAAQ;wBAAE,QAAQ;oBAAK;gBACzB;YACF;QACF;QAEA,8BAA8B;QAC9B,MAAM,mBAAmB,QAAQ,GAAG,CAAC,CAAC,SAA4B,CAAC;gBACjE,IAAI,OAAO,EAAE;gBACb,MAAM,OAAO,IAAI;gBACjB,OAAO,OAAO,KAAK;gBACnB,YAAY,OAAO,MAAM,CAAC,MAAM;YAClC,CAAC;QAED,OAAO,+PAAY,CAAC,IAAI,CAAC;YACvB,SAAS;QACX;IACF,EAAE,OAAO,OAAO;QACd,+IAAM,CAAC,KAAK,CAAC;YAAE,KAAK;QAAM,GAAG;QAC7B,OAAO,+PAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAA0B,GACnC;YAAE,QAAQ;QAAI;IAElB;AACF;AAIO,MAAM,MAAM"}}]
}
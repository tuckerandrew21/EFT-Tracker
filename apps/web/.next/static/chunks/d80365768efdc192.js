(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,10012,e=>{"use strict";var t=e.i(95),s=e.i(86375),a=e.i(52088);let r=s.forwardRef(({className:e,type:s,...r},l)=>(0,t.jsx)("input",{type:s,"data-slot":"input",className:(0,a.cn)("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground border-input h-9 w-full min-w-0 rounded-md border bg-[var(--bg-elevated)] px-3 py-1 text-base shadow-inset-input transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",e),ref:l,...r}));r.displayName="Input",e.s(["Input",()=>r])},73554,14294,e=>{"use strict";var t=e.i(95),s=e.i(86375);e.i(34063);var a=e.i(83088),r=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"].reduce((e,r)=>{let l=(0,a.createSlot)(`Primitive.${r}`),n=s.forwardRef((e,s)=>{let{asChild:a,...n}=e;return"undefined"!=typeof window&&(window[Symbol.for("radix-ui")]=!0),(0,t.jsx)(a?l:r,{...n,ref:s})});return n.displayName=`Primitive.${r}`,{...e,[r]:n}},{});e.s(["Primitive",()=>r],14294);var l=s.forwardRef((e,s)=>(0,t.jsx)(r.label,{...e,ref:s,onMouseDown:t=>{t.target.closest("button, input, select, textarea")||(e.onMouseDown?.(t),!t.defaultPrevented&&t.detail>1&&t.preventDefault())}}));l.displayName="Label";var n=e.i(52088);function i({className:e,...s}){return(0,t.jsx)(l,{"data-slot":"label",className:(0,n.cn)("flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",e),...s})}e.s(["Label",()=>i],73554)},9473,e=>{"use strict";let t=(0,e.i(57475).default)("external-link",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);e.s(["ExternalLink",()=>t],9473)},88992,e=>{"use strict";let t=(0,e.i(57475).default)("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);e.s(["AlertCircle",()=>t],88992)},99282,e=>{"use strict";let t={goldOne:"#e8e6d4",goldTwo:"#c4aa6a",gunmetal:"#272727",gunmetalDark:"#1a1a1a",blackLight:"#0f0f0f",border:"rgba(196, 170, 106, 0.4)"},s={prapor:{primary:"#c41e3a",bg:t.gunmetal},therapist:{primary:"#ff69b4",bg:t.gunmetal},skier:{primary:"#1e90ff",bg:t.gunmetal},peacekeeper:{primary:"#228b22",bg:t.gunmetal},mechanic:{primary:"#ff8c00",bg:t.gunmetal},ragman:{primary:"#9370db",bg:t.gunmetal},jaeger:{primary:"#8b4513",bg:t.gunmetal},fence:{primary:"#708090",bg:t.gunmetal},lightkeeper:{primary:"#ffd700",bg:t.gunmetal},ref:{primary:"#20b2aa",bg:t.gunmetal}};function a(e){return s[e.toLowerCase()]||{primary:t.goldTwo,bg:t.gunmetal}}e.s(["EFT_COLORS",0,t,"STATUS_COLORS",0,{locked:{primary:"#5a5a5a",bg:"#1a1a1a",border:"#3a3a3a"},available:{primary:"#4db8ff",bg:"#1a1a1a",border:"#4db8ff"},in_progress:{primary:"#fbbf24",bg:"#1a1a1a",border:"#fbbf24"},completed:{primary:"#4ade80",bg:"#1e2e1e",border:"#4ade80"}},"TRADER_COLORS",0,s,"getTraderColor",()=>a])},59467,92610,e=>{"use strict";let t=(0,e.i(57475).default)("chevron-down",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);e.s(["default",()=>t],92610),e.s(["ChevronDown",()=>t],59467)},8139,e=>{"use strict";var t=e.i(57993);e.s(["Check",()=>t.default])},47608,e=>{"use strict";var t=e.i(95),s=e.i(31104),a=e.i(24139),r=e.i(52088);function l({...e}){return(0,t.jsx)(s.Root,{"data-slot":"dialog",...e})}function n({...e}){return(0,t.jsx)(s.Portal,{"data-slot":"dialog-portal",...e})}function i({className:e,...a}){return(0,t.jsx)(s.Overlay,{"data-slot":"dialog-overlay",className:(0,r.cn)("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",e),...a})}function o({className:e,children:l,showCloseButton:o=!0,...d}){return(0,t.jsxs)(n,{"data-slot":"dialog-portal",children:[(0,t.jsx)(i,{}),(0,t.jsxs)(s.Content,{"data-slot":"dialog-content",className:(0,r.cn)("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-elevation-xl duration-200 sm:max-w-lg",e),...d,children:[l,o&&(0,t.jsxs)(s.Close,{"data-slot":"dialog-close",className:"ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",children:[(0,t.jsx)(a.XIcon,{}),(0,t.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})}function d({className:e,...s}){return(0,t.jsx)("div",{"data-slot":"dialog-header",className:(0,r.cn)("flex flex-col gap-2 text-center sm:text-left",e),...s})}function c({className:e,...s}){return(0,t.jsx)("div",{"data-slot":"dialog-footer",className:(0,r.cn)("flex flex-col-reverse gap-2 sm:flex-row sm:justify-end",e),...s})}function u({className:e,...a}){return(0,t.jsx)(s.Title,{"data-slot":"dialog-title",className:(0,r.cn)("text-lg leading-none font-semibold",e),...a})}function m({className:e,...a}){return(0,t.jsx)(s.Description,{"data-slot":"dialog-description",className:(0,r.cn)("text-muted-foreground text-sm",e),...a})}e.s(["Dialog",()=>l,"DialogContent",()=>o,"DialogDescription",()=>m,"DialogFooter",()=>c,"DialogHeader",()=>d,"DialogTitle",()=>u])},23158,e=>{"use strict";let t=(0,e.i(57475).default)("fast-forward",[["path",{d:"M12 6a2 2 0 0 1 3.414-1.414l6 6a2 2 0 0 1 0 2.828l-6 6A2 2 0 0 1 12 18z",key:"b19h5q"}],["path",{d:"M2 6a2 2 0 0 1 3.414-1.414l6 6a2 2 0 0 1 0 2.828l-6 6A2 2 0 0 1 2 18z",key:"h7h5ge"}]]);e.s(["FastForward",()=>t],23158)},71437,e=>{"use strict";var t=e.i(20287);e.s(["ChevronRight",()=>t.default])},68169,e=>{"use strict";let t=(0,e.i(57475).default)("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);e.s(["Plus",()=>t],68169)},56876,e=>{"use strict";function t(e){let t=new Map;for(let s of e)t.set(s.id,s);return t}function s(e,t,a=new Set){if(a.has(e))return a;let r=t.get(e);if(!r)return a;for(let l of(a.add(e),r.dependsOn||[])){let e=l.requiredQuest?.id;e&&s(e,t,a)}return a}function a(e,t){return{questId:e.id,questTitle:e.title,traderId:e.traderId,traderName:e.trader?.name||"Unknown",traderColor:e.trader?.color||"#888888",levelRequired:e.levelRequired,chainLength:s(e.id,t).size-1}}function r(e,r){return{prerequisites:function(e,r){let l=t(r),n=new Set;for(let t of e){let e=s(t,l);for(let s of(e.delete(t),e))n.add(s)}let i=[];for(let e of n){let t=l.get(e);t&&i.push(a(t,l))}return i.sort((e,t)=>e.chainLength-t.chainLength)}(e,r),completedBranches:function(e,r){let l=t(r),n=new Set(e),i=new Set;for(let t of e)for(let e of s(t,l))i.add(e);let o=new Set;for(let t of e)for(let e of function e(t,s,a=new Set){if(a.has(t))return a;let r=s.get(t);if(!r)return a;for(let l of(a.add(t),r.dependedOnBy||[])){let t=l.dependentQuest?.id;t&&e(t,s,a)}return a}(t,l))o.add(e);let d=[];for(let e of r){if(!(!e.dependedOnBy||0===e.dependedOnBy.length)||n.has(e.id)||i.has(e.id)||o.has(e.id))continue;let t=s(e.id,l),r=!1;for(let e of t)if(i.has(e)){r=!0;break}if(r){let t=a(e,l);d.push(t)}}return d.sort((e,t)=>e.levelRequired!==t.levelRequired?e.levelRequired-t.levelRequired:e.traderName.localeCompare(t.traderName))}(e,r)}}function l(e){let t=new Map;for(let s of e){let e=t.get(s.traderId)||[];e.push(s),t.set(s.traderId,e)}return t}e.s(["calculateCatchUp",()=>r,"groupByTrader",()=>l])},57213,77033,e=>{"use strict";var t=e.i(95),s=e.i(86375),a=e.i(47608),r=e.i(85902),l=e.i(10012),n=e.i(99282),i=e.i(56876),o=e.i(59467),d=e.i(71437),c=e.i(52088);let u=s.forwardRef(({className:e,onCheckedChange:s,onChange:a,...r},l)=>(0,t.jsx)("input",{type:"checkbox",className:(0,c.cn)("h-4 w-4 rounded border border-[var(--tactical-border)] bg-[var(--bg-card)]","text-[var(--accent-gold)] focus:ring-[var(--accent-gold)] focus:ring-offset-0","cursor-pointer transition-colors","checked:bg-[var(--accent-gold)] checked:border-[var(--accent-gold)]",e),ref:l,onChange:e=>{a?.(e),s?.(e.target.checked)},...r}));function m({traderName:e,traderColor:a,quests:r,showCheckboxes:l=!1,checkedQuests:n,onToggleQuest:i,defaultExpanded:c=!0}){let[m,p]=(0,s.useState)(c),f=l&&n?r.filter(e=>n.has(e.questId)).length:r.length;return(0,t.jsxs)("div",{className:"border border-[var(--tactical-border)] rounded-md overflow-hidden",children:[(0,t.jsx)("button",{type:"button",onClick:()=>p(!m),className:"w-full flex items-center justify-between p-3 bg-[var(--bg-elevated)] hover:bg-[var(--bg-panel)] transition-colors","aria-expanded":m,"aria-label":`${e} quests, ${m?"collapse":"expand"}`,children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[m?(0,t.jsx)(o.ChevronDown,{className:"h-4 w-4 text-[var(--text-secondary)]"}):(0,t.jsx)(d.ChevronRight,{className:"h-4 w-4 text-[var(--text-secondary)]"}),(0,t.jsx)("span",{className:"font-medium",style:{color:a},children:e}),(0,t.jsxs)("span",{className:"text-xs text-[var(--text-dim)]",children:["(",f,"/",r.length,")"]})]})}),m&&(0,t.jsx)("div",{className:"divide-y divide-[var(--tactical-border)]",children:r.map(e=>(0,t.jsxs)("div",{className:"flex items-center gap-3 p-3 bg-[var(--bg-card)]",children:[l&&n&&i?(0,t.jsx)(u,{id:`quest-${e.questId}`,checked:n.has(e.questId),onCheckedChange:()=>i(e.questId)}):(0,t.jsx)("div",{className:"w-4 h-4 rounded border border-[var(--tactical-border)] bg-[var(--success)]/20 flex items-center justify-center",children:(0,t.jsx)("svg",{className:"w-3 h-3 text-[var(--success)]",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),(0,t.jsx)("label",{htmlFor:l?`quest-${e.questId}`:void 0,className:"flex-1 text-sm text-[var(--text-bright)] cursor-pointer",children:e.questTitle}),(0,t.jsxs)("span",{className:"text-xs text-[var(--text-dim)]",children:["Lv. ",e.levelRequired]})]},e.questId))})]})}u.displayName="Checkbox";var p=e.i(57475);let f=(0,p.default)("search",[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]]);var h=e.i(83832),g=e.i(98844),x=e.i(46361),x=x;let v=(0,p.default)("chevron-left",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);var b=e.i(26178),b=b;let y=(0,p.default)("lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);var j=e.i(95403);function w({open:e,onOpenChange:o,quests:d,onComplete:c,existingProgressCount:u=0}){let[p,w]=(0,s.useState)("select"),[k,C]=(0,s.useState)(""),[N,q]=(0,s.useState)([]),[S,R]=(0,s.useState)(null),[T,D]=(0,s.useState)(new Set),[I,L]=(0,s.useState)(!1),M=(0,s.useRef)(null);(0,s.useEffect)(()=>{e||(w("select"),C(""),q([]),R(null),D(new Set))},[e]);let P=(0,s.useMemo)(()=>0===N.length||null===S?null:(0,i.calculateCatchUp)(N.map(e=>e.id),d),[N,d,S]);(0,s.useEffect)(()=>{if(P&&null!==S){let e=new Set;for(let t of P.completedBranches)t.levelRequired<=S&&e.add(t.questId);D(e)}},[P,S]);let O=(0,s.useMemo)(()=>{if(!k.trim())return[];let e=k.toLowerCase(),t=new Set(N.map(e=>e.id));return d.filter(s=>s.title.toLowerCase().includes(e)&&!t.has(s.id)).sort((t,s)=>{let a=t.title.toLowerCase()===e,r=s.title.toLowerCase()===e;return a&&!r?-1:!a&&r?1:t.levelRequired-s.levelRequired}).slice(0,20)},[k,d,N]),B=(0,s.useCallback)(e=>{q(t=>[...t,e]),C(""),M.current?.focus()},[]),E=(0,s.useCallback)(e=>{q(t=>t.filter(t=>t.id!==e))},[]),Q=(0,s.useCallback)(e=>{let t=parseInt(e,10);""===e?R(null):!isNaN(t)&&t>=1&&t<=79&&R(t)},[]),F=(0,s.useCallback)(e=>{D(t=>{let s=new Set(t);return s.has(e)?s.delete(e):s.add(e),s})},[]),$=(0,s.useCallback)(()=>{"select"===p?u>0?w("confirm-reset"):w("review"):"confirm-reset"===p&&w("review")},[p,u]),U=(0,s.useCallback)(()=>{"review"===p?u>0?w("confirm-reset"):w("select"):"confirm-reset"===p&&w("select")},[p,u]),A=(0,s.useCallback)(async()=>{if(0!==N.length&&null!==S){L(!0);try{let e=await fetch("/api/progress/catch-up",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({targetQuests:N.map(e=>e.id),playerLevel:S,confirmedBranches:Array.from(T)})});if(!e.ok){let t=await e.json();throw Error(t.error||"Failed to catch up progress")}let t=await e.json();j.toast.success("Progress synced!",{description:`Completed ${t.completed.length} prerequisite quests${t.completedBranches?.length>0?` and ${t.completedBranches.length} branch quests`:""}.`}),c(),o(!1)}catch(e){j.toast.error("Failed to sync",{description:e instanceof Error?e.message:"Please try again."})}finally{L(!1)}}},[N,S,T,c,o]),z=N.length>0&&null!==S,_=(0,s.useMemo)(()=>P?(0,i.groupByTrader)(P.prerequisites):new Map,[P]),H=(0,s.useMemo)(()=>P?(0,i.groupByTrader)(P.completedBranches):new Map,[P]);return(0,t.jsx)(a.Dialog,{open:e,onOpenChange:o,children:(0,t.jsxs)(a.DialogContent,{className:"max-w-lg max-h-[85vh] flex flex-col overflow-hidden",children:[(0,t.jsxs)(a.DialogHeader,{children:[(0,t.jsxs)(a.DialogTitle,{children:["select"===p&&"Catch Up Progress","confirm-reset"===p&&"Progress Reset Warning","review"===p&&"Review Catch-Up"]}),(0,t.jsxs)(a.DialogDescription,{children:["select"===p&&"Select the quests you're currently working on and enter your PMC level.","confirm-reset"===p&&"This will reset your existing progress before applying the catch-up.","review"===p&&"Review the quests that will be marked as completed."]})]}),(0,t.jsxs)("div",{className:"flex-1 flex flex-col gap-4 py-2 min-h-0 overflow-hidden",children:["select"===p&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"shrink-0",children:[(0,t.jsx)("label",{className:"text-sm font-medium mb-1.5 block",children:"Your PMC Level"}),(0,t.jsx)(l.Input,{type:"number",min:1,max:79,value:S??"",onChange:e=>Q(e.target.value),placeholder:"Enter level (1-79)",className:"w-32"})]}),(0,t.jsxs)("div",{className:"relative shrink-0",children:[(0,t.jsx)(f,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,t.jsx)(l.Input,{ref:M,value:k,onChange:e=>C(e.target.value),placeholder:"Search quests...",className:"pl-9"})]}),k.trim()&&O.length>0&&(0,t.jsx)("div",{className:"border rounded-md max-h-48 overflow-y-auto shrink-0",children:O.map(e=>{let s=(0,n.getTraderColor)(e.traderId);return(0,t.jsxs)("button",{type:"button",onClick:()=>B(e),className:"w-full px-3 py-2 text-left hover:bg-muted flex items-center gap-2 text-sm",children:[(0,t.jsx)("div",{className:"w-2 h-2 rounded-full shrink-0",style:{backgroundColor:s.primary}}),(0,t.jsx)("span",{className:"flex-1 truncate",children:e.title}),(0,t.jsxs)("span",{className:"text-xs text-muted-foreground shrink-0",children:["Lv ",e.levelRequired]})]},e.id)})}),(0,t.jsx)("div",{className:"flex-1 overflow-y-auto min-h-0",children:N.length>0?(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Selected quests (",N.length,"):"]}),(0,t.jsx)("div",{className:"space-y-1",children:N.map(e=>{let s=(0,n.getTraderColor)(e.traderId);return(0,t.jsxs)("div",{className:"flex items-center gap-2 p-2 bg-muted/50 rounded-md text-sm",children:[(0,t.jsx)("div",{className:"w-2 h-2 rounded-full shrink-0",style:{backgroundColor:s.primary}}),(0,t.jsx)("span",{className:"flex-1 truncate",children:e.title}),(0,t.jsxs)("span",{className:"text-xs text-muted-foreground shrink-0",children:["Lv ",e.levelRequired]}),(0,t.jsx)("button",{type:"button",onClick:()=>E(e.id),className:"p-1 hover:bg-muted rounded-sm","aria-label":`Remove ${e.title}`,children:(0,t.jsx)(h.X,{className:"h-3 w-3"})})]},e.id)})})]}):(0,t.jsxs)("div",{className:"text-center py-8 text-muted-foreground",children:[(0,t.jsx)(f,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),(0,t.jsx)("p",{className:"text-sm",children:"Search for quests you're currently working on"})]})})]}),"confirm-reset"===p&&(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center py-8 gap-4",children:[(0,t.jsx)(b.default,{className:"h-12 w-12 text-yellow-500"}),(0,t.jsxs)("div",{className:"text-center space-y-2",children:[(0,t.jsxs)("p",{className:"font-medium",children:["You have ",u," quest",1!==u?"s":""," marked complete."]}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Continuing will reset all existing progress and apply the new catch-up state. This cannot be undone."})]})]}),"review"===p&&P&&(0,t.jsxs)("div",{className:"flex-1 overflow-y-auto space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,t.jsx)(y,{className:"h-4 w-4 text-muted-foreground"}),(0,t.jsx)("h3",{className:"text-sm font-medium",children:"Prerequisites"}),(0,t.jsxs)("span",{className:"text-xs text-muted-foreground",children:["(",P.prerequisites.length," quests)"]})]}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground mb-2",children:"These quests must be completed to reach your selected quests."}),P.prerequisites.length>0?(0,t.jsx)("div",{className:"space-y-1",children:Array.from(_.entries()).map(([e,s])=>(0,t.jsx)(m,{traderId:e,traderName:s[0].traderName,traderColor:s[0].traderColor,quests:s,locked:!0},e))}):(0,t.jsx)("p",{className:"text-sm text-muted-foreground italic",children:"No prerequisites needed."})]}),P.completedBranches.length>0&&(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,t.jsx)(x.default,{className:"h-4 w-4 text-green-500"}),(0,t.jsx)("h3",{className:"text-sm font-medium",children:"Completed Branches"}),(0,t.jsxs)("span",{className:"text-xs text-muted-foreground",children:["(",P.completedBranches.length," terminal quests)"]})]}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground mb-2",children:"These quest chains ended before your current position. Check the ones you've completed."}),(0,t.jsx)("div",{className:"space-y-1",children:Array.from(H.entries()).map(([e,s])=>(0,t.jsx)(m,{traderId:e,traderName:s[0].traderName,traderColor:s[0].traderColor,quests:s,showCheckboxes:!0,checkedIds:T,onToggle:F,playerLevel:S},e))})]})]})]}),(0,t.jsxs)(a.DialogFooter,{className:"flex-row justify-between sm:justify-between",children:[(0,t.jsx)("div",{children:"select"!==p&&(0,t.jsxs)(r.Button,{variant:"outline",onClick:U,disabled:I,children:[(0,t.jsx)(v,{className:"h-4 w-4 mr-1"}),"Back"]})}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(r.Button,{variant:"outline",onClick:()=>o(!1),disabled:I,children:"Cancel"}),"review"===p?(0,t.jsx)(r.Button,{onClick:A,disabled:I||!z,children:I?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(g.Loader2,{className:"h-4 w-4 animate-spin mr-2"}),"Syncing..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(x.default,{className:"h-4 w-4 mr-2"}),"Apply Catch-Up"]})}):(0,t.jsx)(r.Button,{onClick:$,disabled:!z,children:"Next"})]})]})]})})}e.s(["CatchUpDialog",()=>w],77033),e.s([],57213)},37834,e=>{"use strict";var t=e.i(95),s=e.i(47608),a=e.i(85902),r=e.i(7347),l=e.i(99282);function n({open:e,onOpenChange:n,targetQuest:i,prerequisites:o,onConfirm:d,isLoading:c=!1}){if(!i)return null;let u=new Map;for(let e of o){let t=e.trader.id;u.has(t)||u.set(t,[]),u.get(t).push(e)}return(0,t.jsx)(s.Dialog,{open:e,onOpenChange:n,children:(0,t.jsxs)(s.DialogContent,{className:"max-w-md max-h-[80vh] overflow-hidden flex flex-col",children:[(0,t.jsxs)(s.DialogHeader,{children:[(0,t.jsx)(s.DialogTitle,{children:"Skip to Quest"}),(0,t.jsxs)(s.DialogDescription,{children:["Mark all prerequisite quests as completed to unlock"," ",(0,t.jsx)("span",{className:"font-semibold",children:i.title}),"?"]})]}),o.length>0?(0,t.jsxs)("div",{className:"flex-1 overflow-y-auto py-4",children:[(0,t.jsxs)("p",{className:"text-sm text-muted-foreground mb-3",children:["The following ",o.length," quest",o.length>1?"s":""," will be marked as completed:"]}),(0,t.jsx)("div",{className:"space-y-3",children:Array.from(u.entries()).map(([e,s])=>{let a=(0,l.getTraderColor)(e),n=s[0].trader.name;return(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,t.jsx)("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:a.primary}}),(0,t.jsx)("span",{className:"text-xs font-medium text-muted-foreground",children:n}),(0,t.jsx)(r.Badge,{variant:"secondary",className:"text-xs",children:s.length})]}),(0,t.jsx)("ul",{className:"space-y-1 ml-4",children:s.map(e=>(0,t.jsxs)("li",{className:"text-sm flex items-center gap-2",children:[(0,t.jsx)("span",{className:"w-1.5 h-1.5 rounded-full",style:{backgroundColor:a.primary}}),e.title,(0,t.jsxs)("span",{className:"text-xs text-muted-foreground",children:["Lv.",e.levelRequired]})]},e.id))})]},e)})})]}):(0,t.jsx)("div",{className:"py-4 text-sm text-muted-foreground",children:"This quest has no incomplete prerequisites. It should already be available!"}),(0,t.jsxs)(s.DialogFooter,{children:[(0,t.jsx)(a.Button,{variant:"outline",onClick:()=>n(!1),disabled:c,children:"Cancel"}),(0,t.jsx)(a.Button,{onClick:d,disabled:c||0===o.length,children:c?"Completing...":`Complete ${o.length} Quest${1!==o.length?"s":""}`})]})]})})}e.s(["SkipQuestDialog",()=>n])},29810,e=>{"use strict";var t=e.i(95),s=e.i(86375),a=e.i(97624),r=e.i(95403),l=e.i(3957),n=e.i(9714);e.i(75746);var i=e.i(66909),o=e.i(68957),d=e.i(28736),c=e.i(1122),u=e.i(37834);e.i(25693);var m=e.i(50168);e.i(46466);var p=e.i(13097);e.i(57213);var f=e.i(77033),h=e.i(71529),g=e.i(6803),x=e.i(18183);let v={locked:null,available:"completed",in_progress:"completed",completed:"available"};function b(){let{status:e}=(0,a.useSession)(),{setStats:b}=(0,l.useStats)(),{prefs:y,isLoading:j}=(0,n.useUserPrefsContext)(),w="loading"===e||"authenticated"===e&&j,k=(0,s.useMemo)(()=>({playerLevel:y?.playerLevel??1}),[y]),{quests:C,allQuests:N,traders:q,loading:S,initialLoading:R,error:T,filters:D,setFilters:I,applyFilters:L,hasPendingChanges:M,refetch:P}=(0,h.useQuests)({initialFilters:k}),O=(0,s.useRef)(!1);(0,s.useEffect)(()=>{y&&!O.current&&(O.current=!0,I({playerLevel:y.playerLevel??1}),L())},[y,I,L]);let{progress:B,updateStatus:E,unlockedQuests:Q,clearUnlocked:F,error:$,savingQuestIds:U,lastSynced:A,isOnline:z,pendingOfflineCount:_}=(0,g.useProgress)(),[H,W]=(0,s.useState)(null),[G,J]=(0,s.useState)(!1),[K,V]=(0,s.useState)(null),[X,Y]=(0,s.useState)(!1),[Z,ee]=(0,s.useState)(!1),[et,es]=(0,s.useState)(!1),[ea,er]=(0,s.useState)(null),[el,en]=(0,s.useState)(!1),ei=(0,s.useMemo)(()=>!!ea&&U.has(ea.id),[ea,U]),eo=(0,s.useRef)([]),ed=(0,s.useRef)(e),ec=(0,s.useRef)(E),eu=(0,s.useRef)(P),em=(0,s.useMemo)(()=>C.map(e=>{if("locked"===e.computedStatus)return{...e,computedStatus:"locked"};let t=B.get(e.id);return{...e,computedStatus:t||e.computedStatus}}),[C,B]),ep=(0,s.useMemo)(()=>N.map(e=>{if("locked"===e.computedStatus)return{...e,computedStatus:"locked"};let t=B.get(e.id);return{...e,computedStatus:t||e.computedStatus}}),[N,B]);(0,s.useEffect)(()=>{eo.current=em},[em]),(0,s.useEffect)(()=>{ed.current=e},[e]),(0,s.useEffect)(()=>{ec.current=E},[E]),(0,s.useEffect)(()=>{eu.current=P},[P]),(0,s.useEffect)(()=>{if(Q.length>0){let e=Q.length;r.toast.success(`${e} quest${e>1?"s":""} unlocked!`,{description:"New quests are now available."}),F(),P()}},[Q,F,P]),(0,s.useEffect)(()=>{$&&r.toast.error("Progress Error",{description:$})},[$]),(0,s.useEffect)(()=>{S||localStorage.getItem("eft-tracker-onboarding")||ee(!0)},[S]);let ef=(0,s.useCallback)(()=>{localStorage.setItem("eft-tracker-onboarding","completed"),ee(!1)},[]),eh=(0,s.useCallback)(()=>{localStorage.setItem("eft-tracker-onboarding","completed"),ee(!1),es(!0)},[]),eg=(0,s.useCallback)(()=>{P()},[P]),ex=(0,s.useCallback)(e=>{W(t=>t===e?null:e)},[]),ev=(0,s.useCallback)(e=>{let t=eo.current.find(t=>t.id===e);t&&(er(t),en(!0))},[]),eb=(0,s.useMemo)(()=>K?(0,x.getIncompletePrerequisites)(K.id,ep):[],[K,ep]),ey=(0,s.useCallback)(async()=>{if(K&&0!==eb.length){Y(!0);try{for(let e of eb)if(!await E(e.id,"completed")){r.toast.error("Failed to Update",{description:`Could not complete ${e.title}. Please try again.`}),Y(!1);return}r.toast.success(`${eb.length} quest${eb.length>1?"s":""} completed!`,{description:`${K.title} is now available.`}),J(!1),V(null),await P()}catch{r.toast.error("Failed to Update",{description:"Could not complete prerequisite quests. Please try again."})}finally{Y(!1)}}},[K,eb,E,P]),ej=(0,s.useCallback)(async e=>{let t=eo.current.find(t=>t.id===e);if(!t)return;let s=t.computedStatus;if("locked"===s)return"authenticated"!==ed.current?void r.toast.warning("Sign In Required",{description:"Please sign in to track your progress.",action:{label:"Sign In",onClick:()=>window.location.href="/login"}}):(V(t),void J(!0));if("authenticated"!==ed.current)return void r.toast.warning("Sign In Required",{description:"Please sign in to track your progress.",action:{label:"Sign In",onClick:()=>window.location.href="/login"}});let a=v[s];a&&(await ec.current(e,a)?("completed"===a&&r.toast.success("Quest Completed!",{description:t.title}),await eu.current()):r.toast.error("Failed to Update",{description:"Could not update quest status. Please try again."}))},[]),ew=(0,s.useCallback)(async e=>{await ej(e)},[ej]),ek=(0,s.useCallback)(async(e,t)=>{if("authenticated"!==ed.current)return r.toast.error("Sign in Required",{description:"Please sign in to track quest progress."}),{questStatusChanged:!1};try{let s="boolean"==typeof t?{completed:t}:{current:t.current},a=await fetch(`/api/progress/objective/${e}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!a.ok){let e=await a.json().catch(()=>({}));throw Error(e.error||"Failed to update objective")}let l=await a.json();return await eu.current(),l.quest?.statusChanged&&("COMPLETED"===l.quest.status?r.toast.success("Quest Completed!",{description:`All objectives for ${l.quest.title} are complete.`}):"IN_PROGRESS"===l.quest.status&&r.toast.info("Quest Started",{description:l.quest.title})),{questStatusChanged:l.quest?.statusChanged??!1,newQuestStatus:l.quest?.status}}catch(e){return r.toast.error("Failed to Update Objective",{description:e instanceof Error?e.message:"Please try again."}),{questStatusChanged:!1}}},[]),eC=(0,s.useMemo)(()=>({total:em.length,completed:em.filter(e=>"completed"===e.computedStatus).length,available:em.filter(e=>"available"===e.computedStatus).length,locked:em.filter(e=>"locked"===e.computedStatus).length}),[em]);return((0,s.useEffect)(()=>(S||T||b(eC),()=>b(null)),[eC,b,S,T]),R||w)?(0,t.jsx)(c.QuestTreeSkeleton,{}):T?(0,t.jsx)("div",{className:"flex-1 flex items-center justify-center",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("p",{className:"text-lg font-medium text-destructive",children:"Error loading quests"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground mb-4",children:T}),(0,t.jsx)("button",{onClick:()=>P(),className:"px-4 py-2 bg-primary text-primary-foreground rounded-md hover:bg-primary/90",children:"Try Again"})]})}):(0,t.jsxs)("div",{className:"flex-1 flex flex-col",children:[(0,t.jsx)(m.WelcomeModal,{open:Z,onOpenChange:ee,onGetStarted:ef,onCatchUp:eh}),(0,t.jsx)(f.CatchUpDialog,{open:et,onOpenChange:es,quests:ep,onComplete:eg}),(0,t.jsx)(u.SkipQuestDialog,{open:G,onOpenChange:J,targetQuest:K,prerequisites:eb,onConfirm:ey,isLoading:X}),(0,t.jsx)(p.QuestDetailModal,{quest:ea,open:el,onOpenChange:en,onStatusChange:ew,onObjectiveToggle:ek,isSaving:ei}),(0,t.jsx)(o.QuestFilters,{traders:q,quests:ep,filters:D,onFilterChange:I,onApplyFilters:L,hasPendingChanges:M}),(0,t.jsx)("div",{className:"flex-1 min-h-0",children:em.length>0?(0,t.jsx)(i.QuestTree,{quests:em,allQuests:ep,traders:q,selectedQuestId:H,playerLevel:D.playerLevel,maxColumns:null,savingQuestIds:U,onQuestSelect:ex,onStatusChange:ej,onQuestDetails:ev}):(0,t.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,t.jsx)("p",{className:"text-muted-foreground",children:"No quests found matching your filters."})})}),"authenticated"===e&&(0,t.jsx)("div",{className:"shrink-0 px-4 py-2 border-t bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60",children:(0,t.jsx)(d.SyncStatusIndicator,{lastSynced:A,isOnline:z,isSaving:U.size>0,pendingOfflineCount:_})})]})}e.s(["QuestTreeClient",()=>b])}]);
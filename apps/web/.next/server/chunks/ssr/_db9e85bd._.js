module.exports=[28503,a=>{"use strict";var b=a.i(98143),c=a.i(97823),d=a.i(760);let e=c.forwardRef(({className:a,type:c,...e},f)=>(0,b.jsx)("input",{type:c,"data-slot":"input",className:(0,d.cn)("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground border-input h-9 w-full min-w-0 rounded-md border bg-[var(--bg-elevated)] px-3 py-1 text-base shadow-inset-input transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",a),ref:f,...e}));e.displayName="Input",a.s(["Input",()=>e])},58547,50891,a=>{"use strict";var b=a.i(98143),c=a.i(97823);a.i(78979);var d=a.i(14745),e=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"].reduce((a,e)=>{let f=(0,d.createSlot)(`Primitive.${e}`),g=c.forwardRef((a,c)=>{let{asChild:d,...g}=a;return(0,b.jsx)(d?f:e,{...g,ref:c})});return g.displayName=`Primitive.${e}`,{...a,[e]:g}},{});a.s(["Primitive",()=>e],50891);var f=c.forwardRef((a,c)=>(0,b.jsx)(e.label,{...a,ref:c,onMouseDown:b=>{b.target.closest("button, input, select, textarea")||(a.onMouseDown?.(b),!b.defaultPrevented&&b.detail>1&&b.preventDefault())}}));f.displayName="Label";var g=a.i(760);function h({className:a,...c}){return(0,b.jsx)(f,{"data-slot":"label",className:(0,g.cn)("flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",a),...c})}a.s(["Label",()=>h],58547)},69292,a=>{"use strict";let b=(0,a.i(86269).default)("external-link",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);a.s(["ExternalLink",()=>b],69292)},45741,a=>{"use strict";let b=(0,a.i(86269).default)("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);a.s(["AlertCircle",()=>b],45741)},57911,a=>{"use strict";var b=a.i(98143),c=a.i(27759),d=a.i(39524),e=a.i(68177),f=a.i(90460);function g({open:a,onOpenChange:g,targetQuest:h,prerequisites:i,onConfirm:j,isLoading:k=!1}){if(!h)return null;let l=new Map;for(let a of i){let b=a.trader.id;l.has(b)||l.set(b,[]),l.get(b).push(a)}return(0,b.jsx)(c.Dialog,{open:a,onOpenChange:g,children:(0,b.jsxs)(c.DialogContent,{className:"max-w-md max-h-[80vh] overflow-hidden flex flex-col",children:[(0,b.jsxs)(c.DialogHeader,{children:[(0,b.jsx)(c.DialogTitle,{children:"Skip to Quest"}),(0,b.jsxs)(c.DialogDescription,{children:["Mark all prerequisite quests as completed to unlock"," ",(0,b.jsx)("span",{className:"font-semibold",children:h.title}),"?"]})]}),i.length>0?(0,b.jsxs)("div",{className:"flex-1 overflow-y-auto py-4",children:[(0,b.jsxs)("p",{className:"text-sm text-muted-foreground mb-3",children:["The following ",i.length," quest",i.length>1?"s":""," will be marked as completed:"]}),(0,b.jsx)("div",{className:"space-y-3",children:Array.from(l.entries()).map(([a,c])=>{let d=(0,f.getTraderColor)(a),g=c[0].trader.name;return(0,b.jsxs)("div",{children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,b.jsx)("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:d.primary}}),(0,b.jsx)("span",{className:"text-xs font-medium text-muted-foreground",children:g}),(0,b.jsx)(e.Badge,{variant:"secondary",className:"text-xs",children:c.length})]}),(0,b.jsx)("ul",{className:"space-y-1 ml-4",children:c.map(a=>(0,b.jsxs)("li",{className:"text-sm flex items-center gap-2",children:[(0,b.jsx)("span",{className:"w-1.5 h-1.5 rounded-full",style:{backgroundColor:d.primary}}),a.title,(0,b.jsxs)("span",{className:"text-xs text-muted-foreground",children:["Lv.",a.levelRequired]})]},a.id))})]},a)})})]}):(0,b.jsx)("div",{className:"py-4 text-sm text-muted-foreground",children:"This quest has no incomplete prerequisites. It should already be available!"}),(0,b.jsxs)(c.DialogFooter,{children:[(0,b.jsx)(d.Button,{variant:"outline",onClick:()=>g(!1),disabled:k,children:"Cancel"}),(0,b.jsx)(d.Button,{onClick:j,disabled:k||0===i.length,children:k?"Completing...":`Complete ${i.length} Quest${1!==i.length?"s":""}`})]})]})})}a.s(["SkipQuestDialog",()=>g])},75935,a=>{"use strict";var b=a.i(98143),c=a.i(97823),d=a.i(74065),e=a.i(56916),f=a.i(80730),g=a.i(27906);a.i(39994);var h=a.i(32874),i=a.i(24899),j=a.i(3896),k=a.i(63516),l=a.i(57911);a.i(54165);var m=a.i(73920);a.i(86834);var n=a.i(21311);a.i(74475);var o=a.i(32592),p=a.i(70204),q=a.i(49865),r=a.i(52781);let s={locked:null,available:"completed",in_progress:"completed",completed:"available"};function t(){let{status:a}=(0,d.useSession)(),{setStats:t}=(0,f.useStats)(),{prefs:u,isLoading:v}=(0,g.useUserPrefsContext)(),w="loading"===a||"authenticated"===a&&v,x=(0,c.useMemo)(()=>({playerLevel:u?.playerLevel??1}),[u]),{quests:y,allQuests:z,traders:A,loading:B,initialLoading:C,error:D,filters:E,setFilters:F,applyFilters:G,hasPendingChanges:H,refetch:I}=(0,p.useQuests)({initialFilters:x}),J=(0,c.useRef)(!1);(0,c.useEffect)(()=>{u&&!J.current&&(J.current=!0,F({playerLevel:u.playerLevel??1}),G())},[u,F,G]);let{progress:K,updateStatus:L,unlockedQuests:M,clearUnlocked:N,error:O,savingQuestIds:P,lastSynced:Q,isOnline:R,pendingOfflineCount:S}=(0,q.useProgress)(),[T,U]=(0,c.useState)(null),[V,W]=(0,c.useState)(!1),[X,Y]=(0,c.useState)(null),[Z,$]=(0,c.useState)(!1),[_,aa]=(0,c.useState)(!1),[ab,ac]=(0,c.useState)(!1),[ad,ae]=(0,c.useState)(null),[af,ag]=(0,c.useState)(!1),ah=(0,c.useMemo)(()=>!!ad&&P.has(ad.id),[ad,P]),ai=(0,c.useRef)([]),aj=(0,c.useRef)(a),ak=(0,c.useRef)(L),al=(0,c.useRef)(I),am=(0,c.useMemo)(()=>y.map(a=>{if("locked"===a.computedStatus)return{...a,computedStatus:"locked"};let b=K.get(a.id);return{...a,computedStatus:b||a.computedStatus}}),[y,K]),an=(0,c.useMemo)(()=>z.map(a=>{if("locked"===a.computedStatus)return{...a,computedStatus:"locked"};let b=K.get(a.id);return{...a,computedStatus:b||a.computedStatus}}),[z,K]);(0,c.useEffect)(()=>{ai.current=am},[am]),(0,c.useEffect)(()=>{aj.current=a},[a]),(0,c.useEffect)(()=>{ak.current=L},[L]),(0,c.useEffect)(()=>{al.current=I},[I]),(0,c.useEffect)(()=>{if(M.length>0){let a=M.length;e.toast.success(`${a} quest${a>1?"s":""} unlocked!`,{description:"New quests are now available."}),N(),I()}},[M,N,I]),(0,c.useEffect)(()=>{O&&e.toast.error("Progress Error",{description:O})},[O]),(0,c.useEffect)(()=>{B||localStorage.getItem("eft-tracker-onboarding")||aa(!0)},[B]);let ao=(0,c.useCallback)(()=>{localStorage.setItem("eft-tracker-onboarding","completed"),aa(!1)},[]),ap=(0,c.useCallback)(()=>{localStorage.setItem("eft-tracker-onboarding","completed"),aa(!1),ac(!0)},[]),aq=(0,c.useCallback)(()=>{I()},[I]),ar=(0,c.useCallback)(a=>{U(b=>b===a?null:a)},[]),as=(0,c.useCallback)(a=>{let b=ai.current.find(b=>b.id===a);b&&(ae(b),ag(!0))},[]),at=(0,c.useMemo)(()=>X?(0,r.getIncompletePrerequisites)(X.id,an):[],[X,an]),au=(0,c.useCallback)(async()=>{if(X&&0!==at.length){$(!0);try{for(let a of at)if(!await L(a.id,"completed")){e.toast.error("Failed to Update",{description:`Could not complete ${a.title}. Please try again.`}),$(!1);return}e.toast.success(`${at.length} quest${at.length>1?"s":""} completed!`,{description:`${X.title} is now available.`}),W(!1),Y(null),await I()}catch{e.toast.error("Failed to Update",{description:"Could not complete prerequisite quests. Please try again."})}finally{$(!1)}}},[X,at,L,I]),av=(0,c.useCallback)(async a=>{let b=ai.current.find(b=>b.id===a);if(!b)return;let c=b.computedStatus;if("locked"===c)return"authenticated"!==aj.current?void e.toast.warning("Sign In Required",{description:"Please sign in to track your progress.",action:{label:"Sign In",onClick:()=>window.location.href="/login"}}):(Y(b),void W(!0));if("authenticated"!==aj.current)return void e.toast.warning("Sign In Required",{description:"Please sign in to track your progress.",action:{label:"Sign In",onClick:()=>window.location.href="/login"}});let d=s[c];d&&(await ak.current(a,d)?("completed"===d&&e.toast.success("Quest Completed!",{description:b.title}),await al.current()):e.toast.error("Failed to Update",{description:"Could not update quest status. Please try again."}))},[]),aw=(0,c.useCallback)(async a=>{await av(a)},[av]),ax=(0,c.useCallback)(async(a,b)=>{if("authenticated"!==aj.current)return e.toast.error("Sign in Required",{description:"Please sign in to track quest progress."}),{questStatusChanged:!1};try{let c="boolean"==typeof b?{completed:b}:{current:b.current},d=await fetch(`/api/progress/objective/${a}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)});if(!d.ok){let a=await d.json().catch(()=>({}));throw Error(a.error||"Failed to update objective")}let f=await d.json();return await al.current(),f.quest?.statusChanged&&("COMPLETED"===f.quest.status?e.toast.success("Quest Completed!",{description:`All objectives for ${f.quest.title} are complete.`}):"IN_PROGRESS"===f.quest.status&&e.toast.info("Quest Started",{description:f.quest.title})),{questStatusChanged:f.quest?.statusChanged??!1,newQuestStatus:f.quest?.status}}catch(a){return e.toast.error("Failed to Update Objective",{description:a instanceof Error?a.message:"Please try again."}),{questStatusChanged:!1}}},[]),ay=(0,c.useMemo)(()=>({total:am.length,completed:am.filter(a=>"completed"===a.computedStatus).length,available:am.filter(a=>"available"===a.computedStatus).length,locked:am.filter(a=>"locked"===a.computedStatus).length}),[am]);return((0,c.useEffect)(()=>(B||D||t(ay),()=>t(null)),[ay,t,B,D]),C||w)?(0,b.jsx)(k.QuestTreeSkeleton,{}):D?(0,b.jsx)("div",{className:"flex-1 flex items-center justify-center",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("p",{className:"text-lg font-medium text-destructive",children:"Error loading quests"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground mb-4",children:D}),(0,b.jsx)("button",{onClick:()=>I(),className:"px-4 py-2 bg-primary text-primary-foreground rounded-md hover:bg-primary/90",children:"Try Again"})]})}):(0,b.jsxs)("div",{className:"flex-1 flex flex-col",children:[(0,b.jsx)(m.WelcomeModal,{open:_,onOpenChange:aa,onGetStarted:ao,onCatchUp:ap}),(0,b.jsx)(o.CatchUpDialog,{open:ab,onOpenChange:ac,quests:an,onComplete:aq}),(0,b.jsx)(l.SkipQuestDialog,{open:V,onOpenChange:W,targetQuest:X,prerequisites:at,onConfirm:au,isLoading:Z}),(0,b.jsx)(n.QuestDetailModal,{quest:ad,open:af,onOpenChange:ag,onStatusChange:aw,onObjectiveToggle:ax,isSaving:ah}),(0,b.jsx)(i.QuestFilters,{traders:A,quests:an,filters:E,onFilterChange:F,onApplyFilters:G,hasPendingChanges:H}),(0,b.jsx)("div",{className:"flex-1 min-h-0",children:am.length>0?(0,b.jsx)(h.QuestTree,{quests:am,allQuests:an,traders:A,selectedQuestId:T,playerLevel:E.playerLevel,maxColumns:null,savingQuestIds:P,onQuestSelect:ar,onStatusChange:av,onQuestDetails:as}):(0,b.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,b.jsx)("p",{className:"text-muted-foreground",children:"No quests found matching your filters."})})}),"authenticated"===a&&(0,b.jsx)("div",{className:"shrink-0 px-4 py-2 border-t bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60",children:(0,b.jsx)(j.SyncStatusIndicator,{lastSynced:Q,isOnline:R,isSaving:P.size>0,pendingOfflineCount:S})})]})}a.s(["QuestTreeClient",()=>t])}];

//# sourceMappingURL=_db9e85bd._.js.map
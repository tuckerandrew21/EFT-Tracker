module.exports=[71531,a=>{"use strict";var b=a.i(98143),c=a.i(97823),d=a.i(74065),e=a.i(56916),f=a.i(80730),g=a.i(27906);a.i(39994);var h=a.i(3896);a.i(15647);var i=a.i(47100),j=a.i(58547),k=a.i(5008),l=a.i(47885),m=a.i(74402),n=a.i(90460);function o({traders:a,quests:d,filters:e,onFilterChange:f,onApplyFilters:g}){let h=(0,m.useUpdateUserPrefs)(),o=(0,c.useRef)(g);(0,c.useEffect)(()=>{o.current=g}),(0,c.useEffect)(()=>{let a=setTimeout(()=>{void 0!==e.playerLevel&&null!==e.playerLevel&&h.mutate({playerLevel:e.playerLevel})},1e3);return()=>clearTimeout(a)},[e.playerLevel]);let p=(0,c.useCallback)(a=>{f(a),setTimeout(()=>o.current(),0)},[f]),q=(0,c.useRef)(null),r=(0,c.useCallback)(a=>{f({playerLevel:a}),q.current&&clearTimeout(q.current),q.current=setTimeout(()=>{o.current()},500)},[f]);return(0,b.jsx)("div",{className:"bg-background border-b",children:(0,b.jsxs)("div",{className:"px-4 py-2 flex items-center justify-between gap-4",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3 flex-wrap",children:[(0,b.jsxs)(l.Select,{value:e.traderId||"all",onValueChange:a=>p({traderId:"all"===a?null:a}),children:[(0,b.jsx)(l.SelectTrigger,{className:"h-9 w-[140px]",children:(0,b.jsx)(l.SelectValue,{placeholder:"All Traders"})}),(0,b.jsxs)(l.SelectContent,{children:[(0,b.jsx)(l.SelectItem,{value:"all",children:"All Traders"}),a.map(a=>(0,b.jsx)(l.SelectItem,{value:a.id,children:(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:(0,n.getTraderColor)(a.id).primary}}),a.name]})},a.id))]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(j.Label,{htmlFor:"player-level",className:"text-sm whitespace-nowrap",children:"Level:"}),(0,b.jsx)("input",{id:"player-level",type:"number",min:1,max:79,placeholder:"1-79",value:e.playerLevel??"",onChange:a=>{let b=parseInt(a.target.value);r(isNaN(b)?null:Math.min(79,Math.max(1,b)))},className:"h-9 w-16 rounded-md border border-input bg-background px-3 py-1 text-sm shadow-sm transition-colors placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring"})]}),(0,b.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,b.jsx)(k.Switch,{id:"kappa-only",checked:e.kappaOnly,onCheckedChange:a=>p({kappaOnly:a})}),(0,b.jsx)(j.Label,{htmlFor:"kappa-only",className:"text-sm cursor-pointer whitespace-nowrap",children:"Kappa Only"})]})]}),(0,b.jsx)("div",{className:"hidden sm:block",children:(0,b.jsx)(i.ProgressStats,{quests:d,traders:a})})]})})}var p=a.i(63516),q=a.i(57911),r=a.i(30703),s=a.i(69292),t=a.i(760),u=a.i(77430);let v={color:"#636363"};function w({quest:a,playerLevel:d,onStatusChange:e,onQuestDetails:f}){let g=(0,n.getTraderColor)(a.traderId),h=n.STATUS_COLORS[a.computedStatus],[i,j]=(0,c.useState)(!1),k=null!=d&&a.levelRequired<=d,l=null!=d&&a.levelRequired>d&&a.levelRequired<=d+5,m=(0,c.useMemo)(()=>{if(!a.dependsOn)return[];let b=new Map;for(let c of a.dependsOn)if(c.requiredQuest.traderId.toLowerCase()!==a.traderId.toLowerCase()){let a=c.requiredQuest.traderId.toLowerCase(),d=b.get(a);d?d.count++:b.set(a,{name:c.requiredQuest.trader.name,count:1})}return Array.from(b.entries()).map(([a,b])=>({traderId:a,...b}))},[a.dependsOn,a.traderId]);return(0,b.jsxs)("div",{onClick:()=>{j(!0),setTimeout(()=>j(!1),150),e(a.id,a.computedStatus)},onContextMenu:b=>{b.preventDefault(),f&&f(a.id)},className:(0,t.cn)("relative p-2 rounded-lg border transition-all duration-150 cursor-pointer min-h-[44px]","hover:shadow-md",i&&"scale-95","locked"===a.computedStatus&&"opacity-70","completed"===a.computedStatus&&"opacity-70","available"===a.computedStatus&&"shadow-sm hover:shadow-lg",l&&"completed"!==a.computedStatus&&"ring-1 ring-amber-300"),style:{backgroundColor:h.bg,borderColor:"available"===a.computedStatus?g.primary:h.border,borderLeftWidth:4,borderLeftColor:g.primary},children:[a.kappaRequired&&(0,b.jsx)("div",{className:"absolute -top-1 -right-1 w-4 h-4 rounded-full flex items-center justify-center text-[8px] font-bold text-white",style:{backgroundColor:"#FFD700"},title:"Required for Kappa",children:"K"}),m.length>0&&(0,b.jsxs)("div",{className:"flex gap-0.5 mb-1",children:[m.slice(0,2).map(a=>{let c=(0,n.getTraderColor)(a.traderId);return(0,b.jsx)("div",{className:"px-1 rounded text-[8px] font-medium text-white",style:{backgroundColor:c.primary},title:`Requires quest(s) from ${a.name}`,children:a.name.slice(0,2)},a.traderId)}),m.length>2&&(0,b.jsxs)("div",{className:"px-1 rounded text-[8px] font-medium text-white",style:{backgroundColor:"#636363"},children:["+",m.length-2]})]}),(0,b.jsx)("div",{className:"font-semibold text-[14px] leading-tight line-clamp-2",style:{color:"#c7c5b3"},title:a.title,children:a.title}),a.objectivesSummary&&a.objectivesSummary.total>0&&"locked"!==a.computedStatus&&(0,b.jsx)("div",{className:"mt-1",children:(0,b.jsx)("div",{className:"h-1 w-full bg-black/30 rounded-full overflow-hidden",children:(0,b.jsx)("div",{className:"h-full bg-emerald-500 transition-all duration-300",style:{width:`${a.objectivesSummary.completed/a.objectivesSummary.total*100}%`}})})}),(0,b.jsxs)("div",{className:"flex items-center justify-between mt-1",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("span",{className:"text-[12px] font-semibold",style:{color:g.primary},children:a.trader.name}),(0,b.jsxs)("span",{className:"flex items-center gap-0.5",children:[(0,b.jsx)("span",{className:"text-[10px] uppercase tracking-wide",style:{color:"var(--text-tertiary)"},children:"Lv"}),(0,b.jsx)("span",{className:"text-[12px] font-semibold",style:{color:k?"var(--success)":l?"#ca8a00":"var(--text-secondary)"},children:a.levelRequired})]}),a.objectivesSummary&&a.objectivesSummary.total>0&&"locked"!==a.computedStatus&&(0,b.jsxs)("span",{className:"text-[10px]",style:{color:"var(--text-tertiary)"},children:["(",a.objectivesSummary.completed,"/",a.objectivesSummary.total,")"]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-1",children:[f&&(0,b.jsxs)(u.Tooltip,{delayDuration:300,children:[(0,b.jsx)(u.TooltipTrigger,{asChild:!0,children:(0,b.jsx)("button",{type:"button",onClick:b=>{b.preventDefault(),b.stopPropagation(),f&&f(a.id)},onMouseDown:a=>{a.stopPropagation()},onTouchStart:a=>a.stopPropagation(),onTouchEnd:b=>{b.stopPropagation(),b.preventDefault(),f&&f(a.id)},className:"w-6 h-6 flex items-center justify-center opacity-60 hover:opacity-100 transition-colors duration-150 rounded-full hover:bg-black/20 focus:outline-none focus:ring-1 focus:ring-offset-1 pointer-events-auto",style:v,"aria-label":`View ${a.title} details`,children:(0,b.jsx)(r.Info,{className:"w-[14px] h-[14px]"})})}),(0,b.jsx)(u.TooltipContent,{side:"top",sideOffset:4,children:(0,b.jsx)("p",{className:"text-xs",children:"View Details"})})]}),a.wikiLink&&(0,b.jsxs)(u.Tooltip,{delayDuration:300,children:[(0,b.jsx)(u.TooltipTrigger,{asChild:!0,children:(0,b.jsx)("button",{type:"button",onClick:b=>{b.preventDefault(),b.stopPropagation(),a.wikiLink&&window.open(a.wikiLink,"_blank","noopener,noreferrer")},onMouseDown:a=>{a.stopPropagation()},onTouchStart:a=>a.stopPropagation(),onTouchEnd:b=>{b.stopPropagation(),b.preventDefault(),a.wikiLink&&window.open(a.wikiLink,"_blank","noopener,noreferrer")},className:"w-6 h-6 flex items-center justify-center opacity-60 hover:opacity-100 transition-colors duration-150 rounded-full hover:bg-black/20 focus:outline-none focus:ring-1 focus:ring-offset-1 pointer-events-auto",style:v,"aria-label":`Open ${a.title} wiki page`,children:(0,b.jsx)(s.ExternalLink,{className:"w-[14px] h-[14px]"})})}),(0,b.jsx)(u.TooltipContent,{side:"top",sideOffset:4,children:(0,b.jsx)("p",{className:"text-xs",children:"View on Tarkov Wiki"})})]})]})]}),"completed"===a.computedStatus&&(0,b.jsx)("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:(0,b.jsx)("svg",{className:"w-6 h-6 opacity-30",style:{color:"#00a700"},fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M5 13l4 4L19 7"})})})]})}var x=a.i(12188),y=a.i(85146),z=a.i(32755),A=a.i(86269);let B=(0,A.default)("map",[["path",{d:"M14.106 5.553a2 2 0 0 0 1.788 0l3.659-1.83A1 1 0 0 1 21 4.619v12.764a1 1 0 0 1-.553.894l-4.553 2.277a2 2 0 0 1-1.788 0l-4.212-2.106a2 2 0 0 0-1.788 0l-3.659 1.83A1 1 0 0 1 3 19.381V6.618a1 1 0 0 1 .553-.894l4.553-2.277a2 2 0 0 1 1.788 0z",key:"169xi5"}],["path",{d:"M15 5.764v15",key:"1pn4in"}],["path",{d:"M9 3.236v15",key:"1uimfh"}]]),C=(0,A.default)("zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]]);function D({quests:a,playerLevel:d,onQuestClick:e}){let f=(0,c.useMemo)(()=>{let b=[],c=a.filter(a=>"available"===a.computedStatus);if(d)for(let a of c.filter(a=>a.levelRequired<=d&&a.levelRequired>=d-5).slice(0,3))b.push({quest:a,reason:`Perfect for level ${d}`,priority:100-Math.abs(d-a.levelRequired),icon:"level"});for(let a of c.filter(a=>a.kappaRequired).slice(0,2))b.find(b=>b.quest.id===a.id)||b.push({quest:a,reason:"Required for Kappa",priority:90,icon:"kappa"});let e=new Map;for(let b of a)for(let a of b.dependsOn||[]){let b=e.get(a.requiredQuest.id)||0;e.set(a.requiredQuest.id,b+1)}for(let a of c.filter(a=>(e.get(a.id)||0)>=2).sort((a,b)=>(e.get(b.id)||0)-(e.get(a.id)||0)).slice(0,2))if(!b.find(b=>b.quest.id===a.id)){let c=e.get(a.id)||0;b.push({quest:a,reason:`Unlocks ${c} quest${c>1?"s":""}`,priority:80+c,icon:"chain"})}let f=function(a,b){let c=new Map;for(let d of b){let b=function(a,b){let c=new Set([a.id]),d=a=>{for(let e of a.dependsOn||[])if(!c.has(e.requiredQuest.id)){c.add(e.requiredQuest.id);let a=b.find(a=>a.id===e.requiredQuest.id);a&&d(a)}};return d(a),b.filter(a=>c.has(a.id))}(d,a),e=b.filter(a=>"completed"===a.computedStatus).length,f=b.length,g=f>0?e/f:0;c.set(d.id,{completed:e,total:f,completionRate:g})}return c}(a,c);for(let a of c.filter(a=>{let b=f.get(a.id);return b&&b.completionRate>=.6}).slice(0,2))if(!b.find(b=>b.quest.id===a.id)){let c=f.get(a.id);b.push({quest:a,reason:`${c.completed}/${c.total} in chain - finish it!`,priority:85+10*c.completionRate,icon:"momentum"})}let g=function(a){let b=new Map;for(let c of a)for(let a of c.objectives||[])a.map&&b.set(a.map,(b.get(a.map)||0)+1);return b}(c);for(let a of c.filter(a=>(a.objectives||[]).map(a=>a.map).filter(a=>!!a).some(a=>(g.get(a)||0)>=3)).sort((a,b)=>{let c=(a.objectives||[]).map(a=>a.map).filter(a=>!!a),d=(b.objectives||[]).map(a=>a.map).filter(a=>!!a),e=c.length>0?Math.max(...c.map(a=>g.get(a)||0)):0;return(d.length>0?Math.max(...d.map(a=>g.get(a)||0)):0)-e}).slice(0,2))if(!b.find(b=>b.quest.id===a.id)){let c=(a.objectives||[]).map(a=>a.map).filter(a=>!!a),d=c.length>0?Math.max(...c.map(a=>g.get(a)||0)):0,e=c.find(a=>g.get(a)===d);b.push({quest:a,reason:`${d} quests on ${e} - efficient!`,priority:75+Math.min(d,10),icon:"map"})}let h=function(a){let b=new Map;for(let c of a){let a=b.get(c.traderId)||{completed:0,total:0};a.total++,"completed"===c.computedStatus&&a.completed++,b.set(c.traderId,a)}let c=new Map;for(let[a,d]of b.entries())c.set(a,d.completed/d.total);return c}(a);for(let a of c.filter(a=>(h.get(a.traderId)||0)>=.7).sort((a,b)=>(h.get(b.traderId)||0)-(h.get(a.traderId)||0)).slice(0,1))if(!b.find(b=>b.quest.id===a.id)){let c=h.get(a.traderId);b.push({quest:a,reason:`${Math.round(100*c)}% ${a.trader.name} done`,priority:70+5*c,icon:"trader"})}if(d){for(let a of c.filter(a=>{let b=a.experience/1e3;return d<=20?b<5:d>=41?b>20:b>=5&&b<=30}).sort((a,b)=>{let c=a.experience/1e3,e=b.experience/1e3;return d&&d<=20?c-e:d&&d>=41?e-c:0}).slice(0,1))if(!b.find(b=>b.quest.id===a.id)){var i;let c=(i=a.experience/1e3)<3?"Quick win":i<10?"Easy":i<20?"Medium":i<30?"Hard":"Challenge";b.push({quest:a,reason:`${c} - ${a.experience.toLocaleString()} XP`,priority:function(a,b,c){if(!b)return 60;let d=c/1e3;return b<=20&&d<5||b>=41&&d>20?70:60}(60,d,a.experience),icon:"difficulty"})}}let j=new Map;for(let a of c)for(let b of a.objectives||[])b.map&&j.set(b.map,(j.get(b.map)||0)+1);let k=Array.from(j.entries()).sort((a,b)=>b[1]-a[1])[0];if(k)for(let a of c.filter(a=>(a.objectives||[]).some(a=>a.map===k[0])).slice(0,2))b.find(b=>b.quest.id===a.id)||b.push({quest:a,reason:`${k[0]} efficiency`,priority:70,icon:"map"});return(function(a){let b=new Map,c=[];for(let d of a){let a=d.quest.questType,e=b.get(a)||0;e<2&&(c.push(d),b.set(a,e+1))}return c})(b).sort((a,b)=>b.priority-a.priority).slice(0,5)},[a,d]);return 0===f.length?null:(0,b.jsxs)("div",{className:"bg-card border rounded-lg p-3",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-3",children:[(0,b.jsx)(x.Lightbulb,{className:"w-4 h-4 text-[#d4a574]"}),(0,b.jsx)("span",{className:"text-sm font-medium",children:"Next Up"}),(0,b.jsx)(E,{})]}),(0,b.jsx)("div",{className:"space-y-2",children:f.map(({quest:a,reason:c,icon:d})=>{let f=(0,n.getTraderColor)(a.traderId),g=new Map;for(let b of a.objectives||[])b.map&&g.set(b.map,(g.get(b.map)||0)+1);let h=Array.from(g.entries()).sort((a,b)=>b[1]-a[1])[0]?.[0];return(0,b.jsx)("button",{type:"button",onClick:()=>e?.(a.id),className:"w-full text-left p-2 rounded hover:bg-muted transition-colors group",children:(0,b.jsxs)("div",{className:"flex items-start gap-2",children:[(0,b.jsx)("div",{className:"w-1.5 h-1.5 rounded-full mt-1.5 flex-shrink-0",style:{backgroundColor:f.primary}}),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsx)("div",{className:"text-sm font-medium leading-tight group-hover:text-primary transition-colors",children:a.title}),(0,b.jsxs)("div",{className:"flex items-center gap-1.5 text-[11px] mt-0.5",children:[(0,b.jsx)("span",{className:"font-medium",style:{color:f.primary},children:a.trader.name}),h&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"•"}),(0,b.jsx)("span",{className:"text-muted-foreground",children:h})]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-1 text-xs text-muted-foreground mt-0.5",children:[(a=>{switch(a){case"level":return(0,b.jsx)(C,{className:"w-3 h-3 text-emerald-400"});case"kappa":return(0,b.jsx)(z.Star,{className:"w-3 h-3 text-yellow-400 fill-yellow-400"});case"chain":return(0,b.jsx)(y.ChevronRight,{className:"w-3 h-3 text-blue-400"});case"map":return(0,b.jsx)(B,{className:"w-3 h-3 text-purple-400"});case"momentum":return(0,b.jsx)(C,{className:"w-3 h-3 text-orange-400"});case"trader":return(0,b.jsx)(z.Star,{className:"w-3 h-3 text-cyan-400"});case"difficulty":return(0,b.jsx)(x.Lightbulb,{className:"w-3 h-3 text-yellow-500"})}})(d),(0,b.jsx)("span",{children:c})]})]})]})},a.id)})})]})}function E(){return(0,b.jsxs)("div",{className:"group relative",children:[(0,b.jsx)("button",{type:"button",title:"How Next Up Works",className:"text-muted-foreground hover:text-foreground transition-colors",children:(0,b.jsxs)("svg",{className:"w-3.5 h-3.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[(0,b.jsx)("circle",{cx:"12",cy:"12",r:"10",strokeWidth:"2"}),(0,b.jsx)("path",{d:"M12 16v-4M12 8h.01",strokeWidth:"2",strokeLinecap:"round"})]})}),(0,b.jsxs)("div",{className:"absolute left-0 top-full mt-2 w-64 bg-popover border rounded-lg p-3 text-xs opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all z-50 shadow-lg",children:[(0,b.jsx)("p",{className:"font-medium mb-2",children:"How Next Up Works"}),(0,b.jsxs)("ul",{className:"space-y-1 text-muted-foreground",children:[(0,b.jsx)("li",{children:"• Your level and available quests"}),(0,b.jsx)("li",{children:"• Kappa requirements"}),(0,b.jsx)("li",{children:"• Quest chains and dependencies"}),(0,b.jsx)("li",{children:"• Map efficiency and synergy"}),(0,b.jsx)("li",{children:"• Your trader progress"}),(0,b.jsx)("li",{children:"• Quest difficulty based on XP rewards"})]})]})]})}let F=["Factory","Customs","Woods","Shoreline","Interchange","Reserve","Labs","Lighthouse","Streets of Tarkov","Ground Zero"],G="Any Location";function H(a){return a.progress?.[0]?.completed??!1}function I({quests:a,allQuests:d,playerLevel:e,onStatusChange:f,onQuestDetails:g}){let h=(0,c.useMemo)(()=>{let b=new Map;for(let a of F)b.set(a,[]);for(let c of(b.set(G,[]),a)){let a=function(a){let b=new Set,c=!1;for(let d of a.objectives)if(!H(d)&&d.maps&&d.maps.length>0)for(let a of(c=!0,d.maps))b.add(a);return!c&&(a.objectives.some(a=>!H(a))||"completed"!==a.computedStatus)?a.location?[a.location]:[]:Array.from(b)}(c);if(0===a.length)b.get(G).push(c);else for(let d of a)b.has(d)&&b.get(d).push(c)}for(let[,a]of b)a.sort((a,b)=>a.levelRequired!==b.levelRequired?a.levelRequired-b.levelRequired:a.trader.name.localeCompare(b.trader.name));return b},[a]),i=(0,c.useMemo)(()=>{let a=new Map;for(let b of[...F,G]){let c=h.get(b)||[];a.set(b,{total:c.length,completed:c.filter(a=>"completed"===a.computedStatus).length,available:c.filter(a=>"available"===a.computedStatus).length})}return a},[h]),j=(0,c.useMemo)(()=>[...F,G].sort((a,b)=>{let c=i.get(a)?.total||0,d=i.get(b)?.total||0;return d!==c?d-c:a.localeCompare(b)}),[i]),k=d??[];return(0,b.jsx)("div",{className:"h-full overflow-auto",children:(0,b.jsxs)("div",{className:"flex gap-2 p-4 min-w-max",children:[k&&k.length>0&&(0,b.jsx)("div",{className:"flex-shrink-0 w-48 sticky left-4 z-20",children:(0,b.jsx)(D,{quests:k,playerLevel:e,onQuestClick:a=>{g?.(a)}})}),j.map(a=>{let c=h.get(a)||[],d=i.get(a);return 0===c.length&&a!==G?null:(0,b.jsxs)("div",{className:"flex-shrink-0 w-36 sm:w-48",children:[(0,b.jsxs)("div",{className:"sticky top-0 z-10 p-2 rounded-t-lg border-b-2",style:{backgroundColor:"#383945",borderColor:d.available>0?"#0292c0":"#636363"},children:[(0,b.jsx)("div",{className:"font-semibold text-sm",style:{color:"#c7c5b3"},children:a}),(0,b.jsxs)("div",{className:"text-xs",style:{color:"#636363"},children:[d.completed,"/",d.total," completed",d.available>0&&(0,b.jsxs)("span",{style:{color:"#0292c0"},className:"ml-1",children:["(",d.available," available)"]})]})]}),(0,b.jsx)("div",{className:"space-y-2 p-2 min-h-[200px] rounded-b-lg",style:{backgroundColor:"rgba(56, 57, 69, 0.5)"},children:0===c.length?(0,b.jsx)("div",{className:"text-xs text-center py-4",style:{color:"#636363"},children:"No quests"}):c.map(a=>(0,b.jsx)(w,{quest:a,playerLevel:e,onStatusChange:f,onQuestDetails:g},a.id))})]},a)})]})})}a.i(54165);var J=a.i(73920);a.i(86834);var K=a.i(21311);a.i(74475);var L=a.i(32592),M=a.i(70204),N=a.i(49865),O=a.i(52781);let P={locked:null,available:"completed",in_progress:"completed",completed:"available"};function Q(){let{status:a}=(0,d.useSession)(),{setStats:i}=(0,f.useStats)(),{prefs:j,isLoading:k}=(0,g.useUserPrefsContext)(),l="loading"===a||"authenticated"===a&&k,m=(0,c.useMemo)(()=>({statuses:["available"],playerLevel:j?.playerLevel??1}),[j]),{quests:n,allQuests:r,traders:s,loading:t,initialLoading:u,error:v,filters:w,setFilters:x,applyFilters:y,refetch:z}=(0,M.useQuests)({initialFilters:m}),A=(0,c.useRef)(!1);(0,c.useEffect)(()=>{j&&!A.current&&(A.current=!0,x({playerLevel:j.playerLevel??1}),y())},[j,x,y]);let{progress:B,updateStatus:C,unlockedQuests:D,clearUnlocked:E,error:F,savingQuestIds:G,lastSynced:H,isOnline:Q,pendingOfflineCount:R}=(0,N.useProgress)(),[S,T]=(0,c.useState)(!1),[U,V]=(0,c.useState)(null),[W,X]=(0,c.useState)(!1),[Y,Z]=(0,c.useState)(!1),[$,_]=(0,c.useState)(!1),[aa,ab]=(0,c.useState)(null),[ac,ad]=(0,c.useState)(!1),ae=(0,c.useMemo)(()=>!!aa&&G.has(aa.id),[aa,G]),af=(0,c.useRef)([]),ag=(0,c.useRef)(a),ah=(0,c.useRef)(C),ai=(0,c.useRef)(z),aj=(0,c.useMemo)(()=>n.map(a=>{if("locked"===a.computedStatus)return{...a,computedStatus:"locked"};let b=B.get(a.id);return{...a,computedStatus:b||a.computedStatus}}),[n,B]),ak=(0,c.useMemo)(()=>r.map(a=>{if("locked"===a.computedStatus)return{...a,computedStatus:"locked"};let b=B.get(a.id);return{...a,computedStatus:b||a.computedStatus}}),[r,B]);(0,c.useEffect)(()=>{af.current=aj},[aj]),(0,c.useEffect)(()=>{ag.current=a},[a]),(0,c.useEffect)(()=>{ah.current=C},[C]),(0,c.useEffect)(()=>{ai.current=z},[z]),(0,c.useEffect)(()=>{if(D.length>0){let a=D.length;e.toast.success(`${a} quest${a>1?"s":""} unlocked!`,{description:"New quests are now available."}),E(),z()}},[D,E,z]),(0,c.useEffect)(()=>{F&&e.toast.error("Progress Error",{description:F})},[F]),(0,c.useEffect)(()=>{t||localStorage.getItem("eft-tracker-onboarding")||Z(!0)},[t]);let al=(0,c.useCallback)(()=>{localStorage.setItem("eft-tracker-onboarding","completed"),Z(!1)},[]),am=(0,c.useCallback)(()=>{localStorage.setItem("eft-tracker-onboarding","completed"),Z(!1),_(!0)},[]),an=(0,c.useCallback)(()=>{z()},[z]),ao=(0,c.useCallback)(a=>{let b=af.current.find(b=>b.id===a);b&&(ab(b),ad(!0))},[]),ap=(0,c.useMemo)(()=>U?(0,O.getIncompletePrerequisites)(U.id,ak):[],[U,ak]),aq=(0,c.useCallback)(async()=>{if(U&&0!==ap.length){X(!0);try{for(let a of ap)if(!await C(a.id,"completed")){e.toast.error("Failed to Update",{description:`Could not complete ${a.title}. Please try again.`}),X(!1);return}e.toast.success(`${ap.length} quest${ap.length>1?"s":""} completed!`,{description:`${U.title} is now available.`}),T(!1),V(null),await z()}catch{e.toast.error("Failed to Update",{description:"Could not complete prerequisite quests. Please try again."})}finally{X(!1)}}},[U,ap,C,z]),ar=(0,c.useCallback)(async a=>{let b=af.current.find(b=>b.id===a);if(!b)return;let c=b.computedStatus;if("locked"===c)return"authenticated"!==ag.current?void e.toast.warning("Sign In Required",{description:"Please sign in to track your progress.",action:{label:"Sign In",onClick:()=>window.location.href="/login"}}):(V(b),void T(!0));if("authenticated"!==ag.current)return void e.toast.warning("Sign In Required",{description:"Please sign in to track your progress.",action:{label:"Sign In",onClick:()=>window.location.href="/login"}});let d=P[c];d&&(await ah.current(a,d)?("completed"===d&&e.toast.success("Quest Completed!",{description:b.title}),await ai.current()):e.toast.error("Failed to Update",{description:"Could not update quest status. Please try again."}))},[]),as=(0,c.useCallback)(async a=>{await ar(a)},[ar]),at=(0,c.useCallback)(async(a,b)=>{if("authenticated"!==ag.current)return e.toast.error("Sign in Required",{description:"Please sign in to track quest progress."}),{questStatusChanged:!1};try{let c="boolean"==typeof b?{completed:b}:{current:b.current},d=await fetch(`/api/progress/objective/${a}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)});if(!d.ok){let a=await d.json().catch(()=>({}));throw Error(a.error||"Failed to update objective")}let f=await d.json();return await ai.current(),f.quest?.statusChanged&&("COMPLETED"===f.quest.status?e.toast.success("Quest Completed!",{description:`All objectives for ${f.quest.title} are complete.`}):"IN_PROGRESS"===f.quest.status&&e.toast.info("Quest Started",{description:f.quest.title})),{questStatusChanged:f.quest?.statusChanged??!1,newQuestStatus:f.quest?.status}}catch(a){return e.toast.error("Failed to Update Objective",{description:a instanceof Error?a.message:"Please try again."}),{questStatusChanged:!1}}},[]),au=(0,c.useMemo)(()=>({total:aj.length,completed:aj.filter(a=>"completed"===a.computedStatus).length,available:aj.filter(a=>"available"===a.computedStatus).length,locked:aj.filter(a=>"locked"===a.computedStatus).length}),[aj]);return((0,c.useEffect)(()=>(t||v||i(au),()=>i(null)),[au,i,t,v]),u||l)?(0,b.jsx)(p.QuestTreeSkeleton,{}):v?(0,b.jsx)("div",{className:"flex-1 flex items-center justify-center",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("p",{className:"text-lg font-medium text-destructive",children:"Error loading quests"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground mb-4",children:v}),(0,b.jsx)("button",{onClick:()=>z(),className:"px-4 py-2 bg-primary text-primary-foreground rounded-md hover:bg-primary/90",children:"Try Again"})]})}):(0,b.jsxs)("div",{className:"flex-1 flex flex-col",children:[(0,b.jsx)(J.WelcomeModal,{open:Y,onOpenChange:Z,onGetStarted:al,onCatchUp:am}),(0,b.jsx)(L.CatchUpDialog,{open:$,onOpenChange:_,quests:ak,onComplete:an}),(0,b.jsx)(q.SkipQuestDialog,{open:S,onOpenChange:T,targetQuest:U,prerequisites:ap,onConfirm:aq,isLoading:W}),(0,b.jsx)(K.QuestDetailModal,{quest:aa,open:ac,onOpenChange:ad,onStatusChange:as,onObjectiveToggle:at,isSaving:ae}),(0,b.jsx)(o,{traders:s,quests:ak,filters:w,onFilterChange:x,onApplyFilters:y}),(0,b.jsx)("div",{className:"flex-1 min-h-0",children:aj.length>0?(0,b.jsx)(I,{quests:aj,allQuests:ak,playerLevel:w.playerLevel,onStatusChange:ar,onQuestDetails:ao}):(0,b.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,b.jsx)("p",{className:"text-muted-foreground",children:"No quests found matching your filters."})})}),"authenticated"===a&&(0,b.jsx)("div",{className:"shrink-0 px-4 py-2 border-t bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60",children:(0,b.jsx)(h.SyncStatusIndicator,{lastSynced:H,isOnline:Q,isSaving:G.size>0,pendingOfflineCount:R})})]})}a.s(["MapsClient",()=>Q],71531)}];

//# sourceMappingURL=apps_web_src_app_maps_MapsClient_tsx_5b19ad13._.js.map